<%- include('../partials/admin-header.ejs', {pageTitle: 'Manajemen Order', path: '/admin/orders' }) %>
<% const adminUrl = '/nori-secret-panel'; %>

<div class="container mx-auto px-4 sm:px-8">
    <div class="py-8">
        <div>
            <h2 class="text-2xl font-semibold leading-tight text-white">Manajemen Pesanan</h2>
            <p class="text-slate-400">Pantau dan kelola semua pesanan yang masuk.</p>
        </div>

        <div class="mt-8">
            <div class="overflow-x-auto bg-slate-800 shadow rounded-lg">
                <div class="inline-block min-w-full"> 
                <table class="min-w-full leading-normal">
                    <thead>
                        <tr>
                            <th class="px-5 py-3 border-b-2 border-slate-700 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider">No. Tiket</th>
                            <th class="px-5 py-3 border-b-2 border-slate-700 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider">Klien</th>
                            <th class="px-5 py-3 border-b-2 border-slate-700 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider">Status</th>
                            <th class="px-5 py-3 border-b-2 border-slate-700 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider">Total</th>
                            <th class="px-5 py-3 border-b-2 border-slate-700 text-center text-xs font-semibold text-slate-300 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% orders.forEach(order => { %>
                            <tr class="hover:bg-slate-700/50">
                                <td class="px-5 py-4 border-b border-slate-700 text-sm">
                                    <p class="text-white font-semibold whitespace-no-wrap"><%= order.ticket_number %></p>
                                    <p class="text-slate-400 text-xs whitespace-no-wrap"><%= new Date(order.created_at).toLocaleString('id-ID') %></p>
                                </td>
                                <td class="px-5 py-4 border-b border-slate-700 text-sm">
                                    <p class="text-white whitespace-no-wrap"><%= order.customer_name %></p>
                                    <p class="text-slate-400 text-xs whitespace-no-wrap"><%= order.customer_email %></p>
                                </td>
                                <td class="px-5 py-4 border-b border-slate-700 text-sm">
                                    <% 
                                    let color = 'yellow';
                                    let text = 'Menunggu Pembayaran';
                                    if (order.status === 'SUCCESS') { color = 'green'; text = 'Telah Dibayar'; }
                                    if (order.status === 'PROCESSING') { color = 'blue'; text = 'Dalam Proses'; }
                                    if (order.status === 'COMPLETED') { color = 'purple'; text = 'Selesai'; }
                                    if (order.status === 'FAILED') { color = 'red'; text = 'Gagal'; }
                                    %>
                                    <span class="relative inline-block px-3 py-1 font-semibold text-<%= color %>-900 leading-tight">
                                        <span aria-hidden class="absolute inset-0 bg-<%= color %>-200 opacity-50 rounded-full"></span>
                                        <span class="relative"><%= text %></span>
                                    </span>
                                </td>
                                 <td class="px-5 py-4 border-b border-slate-700 text-sm">
                                    <p class="text-white whitespace-no-wrap"><%= new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(order.total_amount) %></p>
                                </td>
                                <td class="px-5 py-4 border-b border-slate-700 text-sm text-center">
                                    <a href="<%= adminUrl %>/orders/<%= order.id %>" class="text-cyan-400 hover:text-cyan-300 font-semibold">Lihat Detail</a>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/admin-footer') %>
